<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>Manage Appartements</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- bootstrap css -->
      <link rel="stylesheet" href="css/bootstrap.min.css">
      <!-- style css -->
      <link rel="stylesheet" href="css/style.css">
      <!-- Responsive-->
      <link rel="stylesheet" href="css/responsive.css">
      <!-- fevicon -->
      <link rel="icon" href="images/fevicon.png" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
      <!-- Font Awesome -->
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
   </head>
   <body class="main-layout">
      <!-- loader  -->
      <div class="loader_bg">
         <div class="loader"><img src="images/loading.gif" alt="#"/></div>
      </div>
      <!-- end loader -->

      <div class="back_re">
         <div class="container">
            <div class="row">
               <div class="col-md-6">
                  <div class="title">
                     <h2>Manage Appartements</h2>
                  </div>
               </div>
               <div class="col-md-6 text-right" style="margin-top:25px;">
                  <a href="index.html" class="btn btn-outline-light">Back to Home</a>
                  <a href="host_page.html?mode=simple" class="btn btn-warning" style="margin-left:5px;">
                     + Add new appartement
                  </a>
               </div>
            </div>
         </div>
      </div>

      <div class="our_room" style="padding-top:40px;">
         <div class="container">
            <div class="row">
               <div class="col-md-12">
                  <div class="titlepage">
                     <h2>Your appartements</h2>
                     <p>Here you can see all appartements you posted, modify them or delete them.</p>
                  </div>
               </div>
            </div>

            <div id="noDataMessage" class="alert alert-info" style="display:none;">
               You don't have any appartements yet. Click
               <a href="host_page.html?mode=simple" class="alert-link">"Add new appartement"</a>
               to create one.
            </div>

            <div class="table-responsive" id="tableWrapper" style="display:none;">
               <table class="table table-striped table-bordered" id="aptTable">
                  <thead class="thead-dark">
                     <tr>
                        <th>#</th>
                        <th>Image</th>
                        <th>Title</th>
                        <th>City</th>
                        <th>Guests</th>
                        <th>Price (â‚¬)</th>
                        <th>Owner</th>
                        <th>Actions</th>
                     </tr>
                  </thead>
                  <tbody>
                     <!-- rows added by JS -->
                  </tbody>
               </table>
            </div>
         </div>
      </div>

      <!-- Javascript files-->
      <script src="js/jquery.min.js"></script>
      <script src="js/bootstrap.bundle.min.js"></script>
      <script src="js/jquery-3.0.0.min.js"></script>
      <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
      <script src="js/custom.js"></script>
      <script>
         (function () {
            var STORAGE_KEY = 'appartements';

            function loadAppartements() {
               try {
                  var raw = localStorage.getItem(STORAGE_KEY);
                  return raw ? JSON.parse(raw) : [];
               } catch (e) {
                  return [];
               }
            }

            function saveAppartements(list) {
               localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
            }

            var tableBody = document.querySelector('#aptTable tbody');
            var noDataMessage = document.getElementById('noDataMessage');
            var tableWrapper = document.getElementById('tableWrapper');

            var appartements = loadAppartements();

            function renderTable() {
               tableBody.innerHTML = '';

               if (!appartements.length) {
                  noDataMessage.style.display = 'block';
                  tableWrapper.style.display = 'none';
                  return;
               }

               noDataMessage.style.display = 'none';
               tableWrapper.style.display = 'block';

               appartements.forEach(function (apt, index) {
                  var tr = document.createElement('tr');
                  tr.innerHTML =
                     '<td>' + (index + 1) + '</td>' +
                     '<td><img src="' + (apt.image || '') + '" style="width:70px;height:50px;object-fit:cover;border-radius:4px;"></td>' +
                     '<td>' + (apt.title || '') + '</td>' +
                     '<td>' + (apt.city || '') + '</td>' +
                     '<td>' + (apt.guests || '') + '</td>' +
                     '<td>' + (apt.price || '') + '</td>' +
                     '<td>' + (apt.ownerName || '') + '</td>' +
                     '<td>' +
                        '<button class="btn btn-sm btn-info edit-btn" data-index="' + index + '">Edit</button> ' +
                        '<button class="btn btn-sm btn-danger delete-btn" data-index="' + index + '">Delete</button>' +
                     '</td>';
                  tableBody.appendChild(tr);
               });
            }

            tableBody.addEventListener('click', function (e) {
               if (e.target.classList.contains('edit-btn')) {
                  var index = parseInt(e.target.getAttribute('data-index'), 10);
                  window.location.href = 'host_page.html?index=' + index;
               }

               if (e.target.classList.contains('delete-btn')) {
                  var delIndex = parseInt(e.target.getAttribute('data-index'), 10);
                  if (confirm('Are you sure you want to delete this appartement?')) {
                     appartements.splice(delIndex, 1);
                     saveAppartements(appartements);
                     renderTable();
                  }
               }
            });

            renderTable();
         })();
      </script>
   </body>
</html>


