<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>Post Appartement</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- bootstrap css -->
      <link rel="stylesheet" href="css/bootstrap.min.css">
      <!-- style css -->
      <link rel="stylesheet" href="css/style.css">
      <!-- Responsive-->
      <link rel="stylesheet" href="css/responsive.css">
      <!-- fevicon -->
      <link rel="icon" href="images/fevicon.png" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
      <!-- Font Awesome -->
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
   </head>
   <body class="main-layout">
      <!-- loader  -->
      <div class="loader_bg">
         <div class="loader"><img src="images/loading.gif" alt="#"/></div>
      </div>
      <!-- end loader -->

      <div class="back_re">
         <div class="container">
            <div class="row">
               <div class="col-md-8">
                  <div class="title">
                     <h2>Post Your Appartement</h2>
                  </div>
               </div>
               <div class="col-md-4 text-right" style="margin-top:25px;">
                  <a href="index.html" class="btn btn-outline-light">Back to Home</a>
                  <a href="manage-appartements.html" class="btn btn-warning" style="margin-left:5px;">Manage appartements</a>
               </div>
            </div>
         </div>
      </div>

      <!-- Owner + Appartement Form -->
      <div class="our_room" style="padding-top:40px;">
         <div class="container">
            <div class="row">
               <div class="col-md-12">
                  <div class="titlepage">
                     <h2>Owner information</h2>
                     <p>Fill out the information of the owner and the appartement.</p>
                  </div>
               </div>
            </div>

            <form id="appartementForm" class="shadow p-4 mb-5 bg-white rounded">
               <div id="ownerSection">
                  <h4 class="mb-3"><i class="fa fa-user"></i> Owner</h4>
                  <div class="form-row">
                     <div class="form-group col-md-4">
                        <label for="ownerName">Full name</label>
                        <input type="text" class="form-control" id="ownerName" placeholder="Owner name" required>
                     </div>
                     <div class="form-group col-md-4">
                        <label for="ownerEmail">Email</label>
                        <input type="email" class="form-control" id="ownerEmail" placeholder="Owner email" required>
                     </div>
                     <div class="form-group col-md-4">
                        <label for="ownerPhone">Phone</label>
                        <input type="text" class="form-control" id="ownerPhone" placeholder="Owner phone" required>
                     </div>
                  </div>

                  <hr class="my-4">
               </div>

               <h4 class="mb-3"><i class="fa fa-building"></i> Appartement</h4>
               <div class="form-row">
                  <div class="form-group col-md-6">
                     <label for="aptTitle">Title</label>
                     <input type="text" class="form-control" id="aptTitle" placeholder="Nice appartement in Paris" required>
                  </div>
                  <div class="form-group col-md-3">
                     <label for="aptCity">City</label>
                     <select id="aptCity" class="form-control" required>
                        <option value="">Choose...</option>
                        <option value="paris">Paris</option>
                        <option value="lyon">Lyon</option>
                        <option value="marseille">Marseille</option>
                        <option value="toulouse">Toulouse</option>
                        <option value="nice">Nice</option>
                        <option value="bordeaux">Bordeaux</option>
                     </select>
                  </div>
                  <div class="form-group col-md-3">
                     <label for="aptGuests">Max guests</label>
                     <input type="number" min="1" class="form-control" id="aptGuests" placeholder="2" required>
                  </div>
               </div>

               <div class="form-row">
                  <div class="form-group col-md-6">
                     <label for="aptAddress">Address</label>
                     <input type="text" class="form-control" id="aptAddress" placeholder="Street, number, zip code" required>
                  </div>
                  <div class="form-group col-md-3">
                     <label for="aptPrice">Price per night (â‚¬)</label>
                     <input type="number" min="0" class="form-control" id="aptPrice" placeholder="100" required>
                  </div>
                  <div class="form-group col-md-3">
                     <label for="aptImage">Image (required)</label>
                     <input type="file" class="form-control-file" id="aptImage" accept="image/*" required>
                  </div>
               </div>

               <div class="form-group">
                  <label for="aptDescription">Description</label>
                  <textarea class="form-control" id="aptDescription" rows="3" placeholder="Short description of the appartement" required></textarea>
               </div>

               <div class="form-group">
                  <img id="aptImagePreview" src="" alt="" style="max-width:200px; display:none; margin-top:10px; border-radius:8px;">
               </div>

               <input type="hidden" id="editIndex" value="">

               <button type="submit" class="btn btn-primary">
                  <span id="submitText">Add appartement</span>
               </button>
               <button type="button" id="cancelEdit" class="btn btn-secondary" style="display:none; margin-left:10px;">
                  Cancel edit
               </button>
            </form>
         </div>
      </div>

      <!-- Javascript files-->
      <script src="js/jquery.min.js"></script>
      <script src="js/bootstrap.bundle.min.js"></script>
      <script src="js/jquery-3.0.0.min.js"></script>
      <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
      <script src="js/custom.js"></script>
      <script>
         (function () {
            var STORAGE_KEY = 'appartements';

            function loadAppartements() {
               try {
                  var raw = localStorage.getItem(STORAGE_KEY);
                  return raw ? JSON.parse(raw) : [];
               } catch (e) {
                  return [];
               }
            }

            function saveAppartements(list) {
               localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
            }

            function getEditIndexFromUrl() {
               var params = new URLSearchParams(window.location.search);
               var idx = params.get('index');
               return idx !== null ? parseInt(idx, 10) : null;
            }

            var form = document.getElementById('appartementForm');
            var imageInput = document.getElementById('aptImage');
            var imagePreview = document.getElementById('aptImagePreview');
            var submitText = document.getElementById('submitText');
            var editIndexField = document.getElementById('editIndex');
            var cancelEditBtn = document.getElementById('cancelEdit');
            var ownerSection = document.getElementById('ownerSection');
            var ownerNameInput = document.getElementById('ownerName');
            var ownerEmailInput = document.getElementById('ownerEmail');
            var ownerPhoneInput = document.getElementById('ownerPhone');

            var params = new URLSearchParams(window.location.search);
            var simpleMode = params.get('mode') === 'simple';

            if (simpleMode) {
               // In simple mode (coming from "Manage appartements") we don't ask for owner info
               if (ownerSection) {
                  ownerSection.style.display = 'none';
               }
               if (ownerNameInput) ownerNameInput.required = false;
               if (ownerEmailInput) ownerEmailInput.required = false;
               if (ownerPhoneInput) ownerPhoneInput.required = false;
            }

            var appartements = loadAppartements();

            var urlEditIndex = getEditIndexFromUrl();
            if (urlEditIndex !== null && appartements[urlEditIndex]) {
               var apt = appartements[urlEditIndex];
               ownerNameInput.value = apt.ownerName || '';
               ownerEmailInput.value = apt.ownerEmail || '';
               ownerPhoneInput.value = apt.ownerPhone || '';
               document.getElementById('aptTitle').value = apt.title || '';
               document.getElementById('aptCity').value = apt.city || '';
               document.getElementById('aptGuests').value = apt.guests || '';
               document.getElementById('aptAddress').value = apt.address || '';
               document.getElementById('aptPrice').value = apt.price || '';
               document.getElementById('aptDescription').value = apt.description || '';

               if (apt.image) {
                  imagePreview.src = apt.image;
                  imagePreview.style.display = 'block';
               }

               imageInput.value = '';
               imageInput.required = false;

               editIndexField.value = String(urlEditIndex);
               submitText.textContent = 'Update appartement';
               cancelEditBtn.style.display = 'inline-block';
            }

            imageInput.addEventListener('change', function (e) {
               var file = e.target.files[0];
               if (!file) {
                  imagePreview.style.display = 'none';
                  imagePreview.src = '';
                  return;
               }
               var reader = new FileReader();
               reader.onload = function (evt) {
                  imagePreview.src = evt.target.result;
                  imagePreview.style.display = 'block';
               };
               reader.readAsDataURL(file);
            });

            cancelEditBtn.addEventListener('click', function () {
               window.location.href = 'manage-appartements.html';
            });

            form.addEventListener('submit', function (e) {
               e.preventDefault();

               var ownerName = simpleMode ? '' : ownerNameInput.value.trim();
               var ownerEmail = simpleMode ? '' : ownerEmailInput.value.trim();
               var ownerPhone = simpleMode ? '' : ownerPhoneInput.value.trim();
               var title = document.getElementById('aptTitle').value.trim();
               var city = document.getElementById('aptCity').value;
               var guests = document.getElementById('aptGuests').value;
               var address = document.getElementById('aptAddress').value.trim();
               var price = document.getElementById('aptPrice').value;
               var description = document.getElementById('aptDescription').value.trim();

               var editIndex = editIndexField.value;

               function saveWithImage(imageData) {
                  var data = {
                     ownerName: ownerName,
                     ownerEmail: ownerEmail,
                     ownerPhone: ownerPhone,
                     title: title,
                     city: city,
                     guests: guests,
                     address: address,
                     price: price,
                     description: description,
                     image: imageData
                  };

                  if (editIndex === '') {
                     appartements.push(data);
                  } else {
                     appartements[parseInt(editIndex, 10)] = data;
                  }

                  saveAppartements(appartements);
                  window.location.href = 'manage-appartements.html';
               }

               var file = imageInput.files[0];
               if (file) {
                  var reader = new FileReader();
                  reader.onload = function (evt) {
                     saveWithImage(evt.target.result);
                  };
                  reader.readAsDataURL(file);
               } else if (editIndex !== '') {
                  var existingImage = (appartements[parseInt(editIndex, 10)] || {}).image;
                  saveWithImage(existingImage || '');
               } else {
                  alert('Please select an image for the appartement.');
               }
            });
         })();
      </script>
   </body>
</html>


